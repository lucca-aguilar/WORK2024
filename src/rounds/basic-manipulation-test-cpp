#include <basic-manipulation-test.h>
#include <Setup.h>

void basicManipulationTest() {
    int cube_counter = 0;
    Serial.println("Entrou na função");
    while(true) {
        Serial.println("Entrou na função");
        // variaveis globais
        int tableHeight = 0;
        int cubeCounter = 0;
        Serial.println("Definiu variaveis");
        // coloca a garra nas posicoes corretas
        Tortuga.defaultClawPosition();
        Serial.println("garra inicial");
        while (true) { // anda ate encontrar a mesa
            Tortuga.moveForward(150);
            int front_distance = usSensorFront.getDistance();
            if (front_distance <= 10) { // se alinha com a mesa
                Tortuga.motorsConfiguration(400, 400);
                Tortuga.moveForward(70);
                Tortuga.motorsConfiguration(stepper_motors_velocity, stepper_motors_acceleration);
                break;
            }
        }
        Serial.println("encontrou a mesa");
        // verifica altura da mesa
        int table_height = Tortuga.checkTableHeight();

        // escaneia em busca de um cubo
        Tortuga.checkForCube(table_height);

        // pega o cubo
        Tortuga.getCube(table_height);

        char cube_color = Tortuga.checkCubeColor();
        if (cube_color == 'B') {
          rgbLED.blue();
          rgbLED.off();
        } else {
          rgbLED.red();
          rgbLED.off();
        }
        cube_counter++;

        Tortuga.moveBackward(400);
        Tortuga.rotateAntiClockwise(562);
        Tortuga.moveForward(250);

        break;
    }
}